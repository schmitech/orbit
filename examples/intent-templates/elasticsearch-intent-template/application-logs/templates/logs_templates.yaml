# Elasticsearch Query DSL Templates for Application Logs
templates:
  - id: search_error_logs_recent #FIXME
    version: "1.0.0"
    description: "Search for recent error logs in application"
    category: "log_search"
    complexity: "simple"

    # Elasticsearch-specific fields
    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    # Elasticsearch Query DSL template (with variable substitution)
    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "match": {
                  "level": "ERROR"
                }
              }
              {% if message %}
              ,{
                "match": {
                  "message": {
                    "query": "{{message}}",
                    "operator": "AND",
                    "fuzziness": "AUTO"
                  }
                }
              }
              {% endif %}
              {% if user_id %}
              ,{
                "term": {
                  "user_id": "{{user_id}}"
                }
              }
              {% endif %}
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              },
              {
                "range": {
                  "status_code": {
                    "gte": {{status_code_min}}
                    {% if status_code_max %}
                    ,"lte": {{status_code_max}}
                    {% endif %}
                  }
                }
              }
              {% if environment %}
              ,{
                "term": {
                  "environment": "{{environment}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "from": {{offset}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "highlight": {
          "fields": {
            "message": {
              "fragment_size": 150,
              "number_of_fragments": 3
            },
            "exception.message": {
              "fragment_size": 150
            }
          },
          "pre_tags": ["<mark>"],
          "post_tags": ["</mark>"]
        },
        "_source": {
          "includes": ["timestamp", "level", "message", "service_name", "user_id", "exception", "request_id"]
        }
      }

    # Template Parameters
    parameters:
      - name: message
        type: string
        required: false
        description: "Error message text to search for"
        location: "body"
        example: "connection timeout"

      - name: user_id
        type: string
        required: false
        description: "User ID associated with error"
        location: "body"
        example: "user123"

      - name: service_name
        type: string
        required: false
        description: "Service name that generated the log"
        location: "body"
        example: "auth-service"

      - name: environment
        type: string
        required: false
        description: "Environment (production, staging, development)"
        location: "body"
        allowed_values: ["production", "staging", "development"]

      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"
        format: "date_time"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"
        format: "date_time"

      - name: status_code_min
        type: integer
        required: false
        default: 500
        description: "Minimum HTTP status code to include"
        location: "body"
        min: 100
        max: 599

      - name: status_code_max
        type: integer
        required: false
        description: "Maximum HTTP status code to include"
        location: "body"
        min: 100
        max: 599

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum number of results"
        location: "body"
        min: 1
        max: 10000

      - name: offset
        type: integer
        required: false
        default: 0
        description: "Result offset for pagination"
        location: "body"
        min: 0

    # Natural Language Examples for Intent Matching
    nl_examples:
      - "Show me recent error logs"
      - "Find errors in the last 24 hours"
      - "What errors did user john123 encounter?"
      - "Search for authentication errors"
      - "Show me errors with message connection timeout"
      - "Get error logs from the auth service"
      - "Find production errors from yesterday"
      - "Show me all errors for user admin"

    # Semantic Tags for Template Matching
    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["error", "recent", "filter"]
      time_based: true

    # Display configuration
    display_fields:
      - "timestamp"
      - "level"
      - "service_name"
      - "message"
      - "user_id"

    # Tags for categorization
    tags: ["logs", "errors", "search", "recent"]
    result_format: "table"
    timeout: 30

  - id: aggregate_errors_by_service #FIXME
    version: "1.0.0"
    description: "Count and group errors by service name"
    category: "log_analytics"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "match": {
                  "level": "ERROR"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if environment %}
              ,{
                "term": {
                  "environment": "{{environment}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": 0,
        "aggs": {
          "by_service": {
            "terms": {
              "field": "service_name.keyword",
              "size": {{agg_size}},
              "order": {
                "_count": "desc"
              }
            },
            "aggs": {
              "error_types": {
                "terms": {
                  "field": "exception.type.keyword",
                  "size": 5
                }
              },
              "avg_response_time": {
                "avg": {
                  "field": "response_time"
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-30d"
        description: "Start of time range"
        location: "body"
        format: "date_time"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"
        format: "date_time"

      - name: environment
        type: string
        required: false
        description: "Filter by environment"
        location: "body"
        allowed_values: ["production", "staging", "development"]

      - name: agg_size
        type: integer
        required: false
        default: 20
        description: "Number of services to return"
        location: "body"
        min: 1
        max: 100

    nl_examples:
      - "How many errors by service?"
      - "Show me error count per service"
      - "Which services have the most errors?"
      - "Count errors grouped by service"
      - "Break down errors by microservice"
      - "What's the error distribution across services?"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "terms"
      group_by: "service_name"

    tags: ["logs", "aggregation", "analytics", "services"]
    result_format: "summary"

  - id: error_timeline
    version: "1.0.0"
    description: "Show error count over time with time-series visualization"
    category: "log_analytics"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "match": {
                  "level": "ERROR"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              },
              {
                "range": {
                  "status_code": {
                    "gte": {{status_code_min}}
                    {% if status_code_max %}
                    ,"lte": {{status_code_max}}
                    {% endif %}
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
              {% if environment %}
              ,{
                "term": {
                  "environment": "{{environment}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": 0,
        "track_total_hits": false,
        "aggs": {
          "errors_over_time": {
            "date_histogram": {
              "field": "timestamp",
              "fixed_interval": "{{interval}}",
              "min_doc_count": 0,
              "extended_bounds": {
                "min": "{{start_time}}",
                "max": "{{end_time}}"
              }
            },
            "aggs": {
              "by_level": {
                "terms": {
                  "field": "level.keyword",
                  "size": 5
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"

      - name: environment
        type: string
        required: false
        description: "Filter by environment"
        allowed_values: ["production", "staging", "development"]

      - name: service_name
        type: string
        required: false
        description: "Filter by specific service"

      - name: status_code_min
        type: integer
        required: false
        default: 500
        description: "Minimum HTTP status code to include"
        min: 100
        max: 599

      - name: status_code_max
        type: integer
        required: false
        description: "Maximum HTTP status code to include"
        min: 100
        max: 599

      - name: interval
        type: string
        required: false
        default: "15m"
        description: "Time bucket interval"
        allowed_values: ["1m", "5m", "15m", "30m", "1h", "6h", "12h", "1d"]

    nl_examples:
      - "Show me error trends over the last 24 hours"
      - "How have errors changed over time?"
      - "Display error timeline"
      - "Graph errors per hour" #Too long
      - "Show error count by hour"
      - "Error spike analysis for auth service"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "date_histogram"
      time_series: true

    tags: ["logs", "analytics", "timeline", "trends"]
    result_format: "timeseries"

  - id: search_slow_requests
    version: "1.0.0"
    description: "Find slow API requests based on response time"
    category: "performance_analysis"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "exists": {
                  "field": "{% if response_time_field %}{{response_time_field}}{% else %}response_time{% endif %}"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              },
              {
                "range": {
                  "{% if response_time_field %}{{response_time_field}}{% else %}response_time{% endif %}": {
                    "gte": {% if min_response_time %}{{min_response_time}}{% else %}1000{% endif %}
                    {% if max_response_time %}
                    ,"lte": {{max_response_time}}
                    {% endif %}
                  }
                }
              }
              {% if endpoint %}
              ,{
                "wildcard": {
                  "endpoint.keyword": "*{{endpoint}}*"
                }
              }
              {% endif %}
              {% if service_name %}
              ,{
                "term": {
                  "service_name.keyword": "{{service_name}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "{% if response_time_field %}{{response_time_field}}{% else %}response_time{% endif %}": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "service_name", "endpoint", "{% if response_time_field %}{{response_time_field}}{% else %}response_time{% endif %}", "status_code", "user_id", "request_id"]
      }

    parameters:
      - name: min_response_time
        type: integer
        required: false
        default: 1000
        description: "Minimum response time in milliseconds"
        min: 0

      - name: endpoint
        type: string
        required: false
        description: "API endpoint to filter"

      - name: service_name
        type: string
        required: false
        description: "Service name to filter"

      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum results"
        min: 1
        max: 1000

      - name: max_response_time
        type: integer
        required: false
        description: "Optional upper bound for response time"
        min: 0
        max: 3600000

      - name: response_time_field
        type: string
        required: false
        default: "response_time"
        description: "Field name to use for response time filtering (override if your mapping differs)"

    nl_examples:
      - "Show me slow requests"
      - "Find API calls taking more than 1 second"
      - "Which endpoints are slow?"
      - "Show requests with high response time"
      - "Find timeouts in the auth service"
      - "Display slowest API calls"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["slow", "performance", "timeout"]

    tags: ["performance", "slow", "requests", "monitoring"]
    result_format: "table"

  # ============================================================================
  # MULTI-INDEX SEARCH TEMPLATES
  # ============================================================================

  - id: search_multi_index_errors
    version: "1.0.0"
    description: "Search for errors across multiple log indices using wildcard patterns"
    category: "multi_index_search"
    complexity: "simple"

    # Multi-index pattern with wildcards
    index: "application-logs-*,system-logs-*"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "match": {
                  "level": "ERROR"
                }
              }
              {% if message %}
              ,{
                "match": {
                  "message": "{{message}}"
                }
              }
              {% endif %}
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              },
              {
                "range": {
                  "status_code": {
                    "gte": {{status_code_min}}
                    {% if status_code_max %}
                    ,"lte": {{status_code_max}}
                    {% endif %}
                  }
                }
              }
              {% if indices %}
              ,{
                "terms": {
                  "_index": {{indices}}
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "level", "message", "service_name", "_index"]
      }

    parameters:
      - name: message
        type: string
        required: false
        description: "Error message to search for"
        location: "body"

      - name: indices
        type: array
        required: false
        description: "Specific indices to search (JSON array)"
        location: "body"
        example: '["application-logs-demo", "system-logs-demo"]'

      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum number of results"
        location: "body"

      - name: status_code_min
        type: integer
        required: false
        default: 500
        description: "Minimum HTTP status code to include"
        location: "body"
        min: 100
        max: 599

      - name: status_code_max
        type: integer
        required: false
        description: "Maximum HTTP status code to include"
        location: "body"
        min: 100
        max: 599

    nl_examples:
      - "Search for errors across all log indices"
      - "Find errors in all application and system logs"
      - "Show me errors from multiple log sources"
      - "Search across all log indices for database errors"

    semantic_tags:
      action: "search"
      primary_entity: "multiple_indices"
      qualifiers: ["error", "cross-index", "wildcard"]
      multi_index: true

    tags: ["logs", "multi-index", "wildcard", "cross-index"]
    result_format: "table"

  # ============================================================================
  # ADVANCED AGGREGATION PIPELINE TEMPLATES
  # ============================================================================

  - id: error_rate_trend_analysis #FIXME
    version: "1.0.0"
    description: "Analyze error rate trends with derivative and cumulative sum"
    category: "advanced_analytics"
    complexity: "advanced"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "match": {
                  "level": "ERROR"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": 0,
        "aggs": {
          "errors_over_time": {
            "date_histogram": {
              "field": "timestamp",
              "fixed_interval": "{{interval}}",
              "min_doc_count": 0
            },
            "aggs": {
              "error_count": {
                "value_count": {
                  "field": "level"
                }
              },
              "error_rate_derivative": {
                "derivative": {
                  "buckets_path": "error_count"
                }
              },
              "cumulative_errors": {
                "cumulative_sum": {
                  "buckets_path": "error_count"
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-7d"
        description: "Start of time range"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"

      - name: service_name
        type: string
        required: false
        description: "Filter by service name"

      - name: interval
        type: string
        required: false
        default: "1h"
        description: "Time bucket interval"
        allowed_values: ["1m", "5m", "15m", "30m", "1h", "6h", "12h", "1d"]

    nl_examples:
      - "Show me error rate trends over time"
      - "Analyze error rate changes over time"
      - "What's the derivative of error rate?"
      - "Show cumulative errors with trend analysis"
      - "Calculate cumulative sum of errors"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "pipeline"
      advanced: true

    tags: ["analytics", "pipeline", "derivative", "cumulative_sum", "trend"]
    result_format: "timeseries"

  - id: performance_percentiles_with_filters #FIXME
    version: "1.0.0"
    description: "Calculate response time percentiles with bucket selector to filter slow services"
    category: "advanced_analytics"
    complexity: "advanced"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "exists": {
                  "field": "response_time"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
            ]
          }
        },
        "size": 0,
        "aggs": {
          "by_service": {
            "terms": {
              "field": "service_name.keyword",
              "size": {{agg_size}}
            },
            "aggs": {
              "response_time_stats": {
                "percentiles": {
                  "field": "response_time",
                  "percents": [50, 75, 90, 95, 99]
                }
              },
              "avg_response_time": {
                "avg": {
                  "field": "response_time"
                }
              },
              "max_response_time": {
                "max": {
                  "field": "response_time"
                }
              },
              "slow_service_filter": {
                "bucket_selector": {
                  "buckets_path": {
                    "avgResponseTime": "avg_response_time"
                  },
                  "script": "params.avgResponseTime != null && params.avgResponseTime > {{threshold}}"
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"
        format: "date_time"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"
        format: "date_time"

      - name: threshold
        type: integer
        required: false
        default: 500
        description: "Response time threshold in ms for filtering"
        location: "body"
        min: 0

      - name: agg_size
        type: integer
        required: false
        default: 20
        description: "Number of services to analyze"
        location: "body"
        min: 1
        max: 100

    nl_examples:
      - "Show me only slow services with percentile breakdown"
      - "Which services have high response times?"
      - "Find services where average response time exceeds threshold"
      - "Show performance percentiles for slow services only"
      - "Filter services by response time and show percentiles"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "pipeline"
      qualifiers: ["performance", "percentiles", "filter"]

    tags: ["performance", "percentiles", "bucket_selector", "filtering"]
    result_format: "summary"

  - id: error_spike_detection
    version: "1.0.0"
    description: "Detect error spikes using bucket script to calculate error rate percentage"
    category: "advanced_analytics"
    complexity: "advanced"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "range": {
            "timestamp": {
              "gte": "{{start_time}}",
              "lte": "{{end_time}}"
            }
          }
        },
        "size": 0,
        "aggs": {
          "by_time": {
            "date_histogram": {
              "field": "timestamp",
              "fixed_interval": "{{interval}}",
              "min_doc_count": 0
            },
            "aggs": {
              "total_logs": {
                "value_count": {
                  "field": "level"
                }
              },
              "error_logs": {
                "filter": {
                  "match": {
                    "level": "ERROR"
                  }
                },
                "aggs": {
                  "count": {
                    "value_count": {
                      "field": "level"
                    }
                  }
                }
              },
              "error_rate": {
                "bucket_script": {
                  "buckets_path": {
                    "errors": "error_logs>count",
                    "total": "total_logs"
                  },
                  "script": "params.total > 0 ? (params.errors / params.total) * 100 : 0"
                }
              },
              "spike_detector": {
                "bucket_selector": {
                  "buckets_path": {
                    "errorRate": "error_rate"
                  },
                  "script": "params.errorRate != null && params.errorRate > {{spike_threshold}}"
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"

      - name: interval
        type: string
        required: false
        default: "5m"
        description: "Time bucket interval"
        allowed_values: ["1m", "5m", "15m", "30m", "1h"]

      - name: spike_threshold
        type: number
        required: false
        default: 10.0
        description: "Error rate percentage threshold for spike detection"
        min: 0
        max: 100

    nl_examples:
      - "Detect error spikes in the last hour"
      - "When did error rate spike above 10%?" #FIXME
      - "Show me time periods with high error rates"
      - "Find error rate anomalies" #FIXME
      - "Calculate error percentage over time"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "pipeline"
      qualifiers: ["error", "spike", "detection", "anomaly"]

    tags: ["analytics", "spike_detection", "bucket_script", "error_rate"]
    result_format: "timeseries"

  # ============================================================================
  # ENDPOINT & API ANALYSIS TEMPLATES
  # ============================================================================

  - id: search_by_endpoint
    version: "1.0.0"
    description: "Search logs for a specific API endpoint"
    category: "api_analysis"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "wildcard": {
                  "endpoint.keyword": "*{{endpoint_pattern}}*"
                }
              }
              {% if level %}
              ,{
                "term": {
                  "level": "{{level}}"
                }
              }
              {% endif %}
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
              {% if status_code_min %}
              ,{
                "range": {
                  "status_code": {
                    "gte": {{status_code_min}}
                    {% if status_code_max %}
                    ,"lte": {{status_code_max}}
                    {% endif %}
                  }
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "level", "message", "service_name", "endpoint", "status_code", "response_time", "user_id", "request_id"]
      }

    parameters:
      - name: endpoint_pattern
        type: string
        required: true
        description: "API endpoint pattern to search for (supports wildcards)"
        location: "body"
        example: "/api/v1/users"

      - name: level
        type: string
        required: false
        description: "Log level to filter"
        location: "body"
        allowed_values: ["ERROR", "WARN", "INFO", "DEBUG", "TRACE"]

      - name: service_name
        type: string
        required: false
        description: "Service name to filter"
        location: "body"

      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: status_code_min
        type: integer
        required: false
        description: "Minimum HTTP status code"
        location: "body"

      - name: status_code_max
        type: integer
        required: false
        description: "Maximum HTTP status code"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Show me logs for the /api/v1/users endpoint"
      - "Find all requests to the inventory API"
      - "What happened on the reports endpoint?"
      - "Show logs for /api/v1/orders"
      - "Find errors on the payment endpoint"
      - "Get logs for the authentication API"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["endpoint", "api", "route"]

    tags: ["logs", "endpoint", "api", "search"]
    result_format: "table"

  - id: endpoint_performance_stats
    version: "1.0.0"
    description: "Get performance statistics grouped by API endpoint"
    category: "api_analysis"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "exists": {
                  "field": "endpoint"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": 0,
        "aggs": {
          "by_endpoint": {
            "terms": {
              "field": "endpoint.keyword",
              "size": {{agg_size}},
              "order": {
                "avg_response_time": "desc"
              }
            },
            "aggs": {
              "avg_response_time": {
                "avg": {
                  "field": "response_time"
                }
              },
              "max_response_time": {
                "max": {
                  "field": "response_time"
                }
              },
              "min_response_time": {
                "min": {
                  "field": "response_time"
                }
              },
              "percentiles": {
                "percentiles": {
                  "field": "response_time",
                  "percents": [50, 90, 95, 99]
                }
              },
              "error_count": {
                "filter": {
                  "range": {
                    "status_code": {
                      "gte": 400
                    }
                  }
                }
              },
              "success_count": {
                "filter": {
                  "range": {
                    "status_code": {
                      "lt": 400
                    }
                  }
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: service_name
        type: string
        required: false
        description: "Filter by specific service"
        location: "body"

      - name: agg_size
        type: integer
        required: false
        default: 20
        description: "Number of endpoints to return"
        location: "body"

    nl_examples:
      - "Which endpoints are slowest?"
      - "Show me API performance by endpoint"
      - "What are the response times for each endpoint?"
      - "Compare endpoint performance"
      - "Which APIs have the highest latency?"
      - "Show endpoint statistics"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "terms"
      group_by: "endpoint"
      qualifiers: ["performance", "latency"]

    tags: ["performance", "endpoint", "api", "latency", "statistics"]
    result_format: "summary"

  # ============================================================================
  # USER ACTIVITY TEMPLATES
  # ============================================================================

  - id: search_user_activity
    version: "1.0.0"
    description: "Search for all activity by a specific user"
    category: "user_analytics"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "user_id": "{{user_id}}"
                }
              }
              {% if message %}
              ,{
                "match": {
                  "message": "{{message}}"
                }
              }
              {% endif %}
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if level %}
              ,{
                "term": {
                  "level": "{{level}}"
                }
              }
              {% endif %}
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "level", "message", "service_name", "endpoint", "status_code", "response_time", "request_id"]
      }

    parameters:
      - name: user_id
        type: string
        required: true
        description: "User ID to search for"
        location: "body"
        example: "user-d0bfa6e5"

      - name: message
        type: string
        required: false
        description: "Message text to search for"
        location: "body"

      - name: level
        type: string
        required: false
        description: "Log level to filter"
        location: "body"
        allowed_values: ["ERROR", "WARN", "INFO", "DEBUG", "TRACE"]

      - name: service_name
        type: string
        required: false
        description: "Service name to filter"
        location: "body"

      - name: start_time
        type: string
        required: false
        default: "now-7d"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 100
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Show me all activity for user user-d0bfa6e5"
      - "What did user john123 do today?"
      - "Find logs for user admin"
      - "Get activity history for user-abc123"
      - "Show me what user xyz did in the last hour"
      - "Track user activity for user-12345"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["user", "activity", "history"]

    tags: ["logs", "user", "activity", "search"]
    result_format: "table"

  - id: most_active_users
    version: "1.0.0"
    description: "Find the most active users by request count"
    category: "user_analytics"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "exists": {
                  "field": "user_id"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
              {% if environment %}
              ,{
                "term": {
                  "environment": "{{environment}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": 0,
        "aggs": {
          "by_user": {
            "terms": {
              "field": "user_id.keyword",
              "size": {{agg_size}},
              "order": {
                "_count": "desc"
              }
            },
            "aggs": {
              "unique_endpoints": {
                "cardinality": {
                  "field": "endpoint.keyword"
                }
              },
              "services_used": {
                "cardinality": {
                  "field": "service_name.keyword"
                }
              },
              "error_count": {
                "filter": {
                  "term": {
                    "level": "ERROR"
                  }
                }
              },
              "last_activity": {
                "max": {
                  "field": "timestamp"
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: service_name
        type: string
        required: false
        description: "Filter by specific service"
        location: "body"

      - name: environment
        type: string
        required: false
        description: "Filter by environment"
        location: "body"
        allowed_values: ["production", "staging", "development"]

      - name: agg_size
        type: integer
        required: false
        default: 20
        description: "Number of users to return"
        location: "body"

    nl_examples:
      - "Who are the most active users?"
      - "Show me top users by activity"
      - "Which users made the most requests?"
      - "Find the busiest users today"
      - "List most active users in production"
      - "Show user activity rankings"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "terms"
      group_by: "user_id"
      qualifiers: ["active", "top", "ranking"]

    tags: ["analytics", "users", "activity", "ranking"]
    result_format: "summary"

  # ============================================================================
  # REQUEST TRACING TEMPLATES
  # ============================================================================

  - id: trace_request
    version: "1.0.0"
    description: "Trace all logs for a specific request ID across services"
    category: "tracing"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "term": {
            "request_id": "{{request_id}}"
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "asc"
            }
          }
        ],
        "_source": ["timestamp", "level", "message", "service_name", "logger", "endpoint", "status_code", "response_time", "user_id", "host"]
      }

    parameters:
      - name: request_id
        type: string
        required: true
        description: "Request ID to trace"
        location: "body"
        example: "a6cfd7e9-3cb0-4e0a-aebb-5382c36a0fc3"

      - name: limit
        type: integer
        required: false
        default: 100
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Trace request a6cfd7e9-3cb0-4e0a-aebb-5382c36a0fc3"
      - "Show me all logs for request ID abc-123"
      - "Follow the request path for request xyz"
      - "Debug request flow for request-id-456"
      - "Track request across services"
      - "Show request trace for correlation ID"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["trace", "request", "correlation"]

    tags: ["tracing", "debugging", "request", "correlation"]
    result_format: "table"

  # ============================================================================
  # ORDER & BUSINESS EVENT TEMPLATES
  # ============================================================================

  - id: search_order_events
    version: "1.0.0"
    description: "Search for order-related events and activities"
    category: "business_events"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "match": {
                  "message": {
                    "query": "{% if order_id %}{{order_id}}{% else %}order{% endif %}",
                    "operator": "AND"
                  }
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if level %}
              ,{
                "term": {
                  "level": "{{level}}"
                }
              }
              {% endif %}
              {% if user_id %}
              ,{
                "term": {
                  "user_id": "{{user_id}}"
                }
              }
              {% endif %}
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "highlight": {
          "fields": {
            "message": {
              "fragment_size": 200
            }
          }
        },
        "_source": ["timestamp", "level", "message", "service_name", "user_id", "request_id", "endpoint"]
      }

    parameters:
      - name: order_id
        type: string
        required: false
        description: "Specific order ID to search for (e.g., ORD-7444bb3b)"
        location: "body"
        example: "ORD-7444bb3b"

      - name: level
        type: string
        required: false
        description: "Log level to filter"
        location: "body"
        allowed_values: ["ERROR", "WARN", "INFO", "DEBUG"]

      - name: user_id
        type: string
        required: false
        description: "User ID associated with the order"
        location: "body"

      - name: service_name
        type: string
        required: false
        description: "Service name to filter"
        location: "body"

      - name: start_time
        type: string
        required: false
        default: "now-7d"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Find logs for order ORD-7444bb3b"
      - "Show me all order events"
      - "Search for order creation logs"
      - "What happened to order ORD-abc123?"
      - "Track order processing"
      - "Find failed orders"
      - "Show order errors"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["order", "business", "transaction"]

    tags: ["orders", "business", "events", "search"]
    result_format: "table"

  - id: search_scheduled_jobs
    version: "1.0.0"
    description: "Search for scheduled job executions and their status"
    category: "operations"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "match": {
                  "message": {
                    "query": "{% if job_name %}{{job_name}}{% else %}scheduled job{% endif %}",
                    "operator": "OR"
                  }
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if level %}
              ,{
                "term": {
                  "level": "{{level}}"
                }
              }
              {% endif %}
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "level", "message", "service_name", "logger", "host", "response_time"]
      }

    parameters:
      - name: job_name
        type: string
        required: false
        description: "Job name to search for (e.g., sync_job)"
        location: "body"
        example: "sync_job"

      - name: level
        type: string
        required: false
        description: "Log level to filter"
        location: "body"
        allowed_values: ["ERROR", "WARN", "INFO", "DEBUG"]

      - name: service_name
        type: string
        required: false
        description: "Service running the job"
        location: "body"

      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Show me scheduled job executions"
      - "Find sync_job runs"
      - "What scheduled jobs ran today?"
      - "Show failed scheduled jobs"
      - "Find cron job logs"
      - "Check job execution status"
      - "List background job runs"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["job", "scheduled", "cron", "background"]

    tags: ["jobs", "scheduled", "operations", "background"]
    result_format: "table"

  # ============================================================================
  # SERVICE HEALTH & COMPARISON TEMPLATES
  # ============================================================================

  - id: service_health_overview
    version: "1.0.0"
    description: "Get health overview for all services including error rates and response times"
    category: "service_analytics"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "range": {
            "timestamp": {
              "gte": "{{start_time}}",
              "lte": "{{end_time}}"
            }
          }
        },
        "size": 0,
        "aggs": {
          "by_service": {
            "terms": {
              "field": "service_name.keyword",
              "size": {{agg_size}}
            },
            "aggs": {
              "total_requests": {
                "value_count": {
                  "field": "request_id.keyword"
                }
              },
              "error_count": {
                "filter": {
                  "term": {
                    "level": "ERROR"
                  }
                }
              },
              "warn_count": {
                "filter": {
                  "term": {
                    "level": "WARN"
                  }
                }
              },
              "avg_response_time": {
                "avg": {
                  "field": "response_time"
                }
              },
              "p95_response_time": {
                "percentiles": {
                  "field": "response_time",
                  "percents": [95]
                }
              },
              "unique_hosts": {
                "cardinality": {
                  "field": "host.keyword"
                }
              },
              "status_codes": {
                "terms": {
                  "field": "status_code",
                  "size": 10
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-1h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: agg_size
        type: integer
        required: false
        default: 20
        description: "Number of services to return"
        location: "body"

    nl_examples:
      - "Show me service health overview"
      - "How are all services performing?"
      - "Give me a health check for all services"
      - "Show service status dashboard"
      - "What's the health of the system?"
      - "Service health summary"
      - "System overview"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "terms"
      group_by: "service_name"
      qualifiers: ["health", "status", "overview"]

    tags: ["health", "services", "monitoring", "dashboard"]
    result_format: "summary"

  - id: compare_environments
    version: "1.0.0"
    description: "Compare metrics between environments (production, staging, development)"
    category: "environment_analytics"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": 0,
        "aggs": {
          "by_environment": {
            "terms": {
              "field": "environment.keyword",
              "size": 5
            },
            "aggs": {
              "total_logs": {
                "value_count": {
                  "field": "level.keyword"
                }
              },
              "by_level": {
                "terms": {
                  "field": "level.keyword",
                  "size": 5
                }
              },
              "avg_response_time": {
                "avg": {
                  "field": "response_time"
                }
              },
              "unique_services": {
                "cardinality": {
                  "field": "service_name.keyword"
                }
              },
              "error_rate": {
                "filter": {
                  "term": {
                    "level": "ERROR"
                  }
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: service_name
        type: string
        required: false
        description: "Filter by specific service"
        location: "body"

    nl_examples:
      - "Compare production vs staging"
      - "How does production compare to development?"
      - "Show environment comparison"
      - "Compare error rates across environments"
      - "Environment health comparison"
      - "Staging vs production metrics"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "terms"
      group_by: "environment"
      qualifiers: ["compare", "environment"]

    tags: ["environment", "comparison", "analytics"]
    result_format: "summary"

  # ============================================================================
  # HOST & INFRASTRUCTURE TEMPLATES
  # ============================================================================

  - id: logs_by_host
    version: "1.0.0"
    description: "Search logs from a specific host or server instance"
    category: "infrastructure"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "wildcard": {
                  "host.keyword": "*{{host_pattern}}*"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if level %}
              ,{
                "term": {
                  "level": "{{level}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "level", "message", "service_name", "host", "logger"]
      }

    parameters:
      - name: host_pattern
        type: string
        required: true
        description: "Host name pattern to search for"
        location: "body"
        example: "payment-service-1"

      - name: level
        type: string
        required: false
        description: "Log level to filter"
        location: "body"
        allowed_values: ["ERROR", "WARN", "INFO", "DEBUG", "TRACE"]

      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Show logs from payment-service-1"
      - "Find logs from host inventory-service-5"
      - "What errors occurred on server user-service-6?"
      - "Get logs from production host"
      - "Show me logs from a specific instance"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["host", "server", "instance"]

    tags: ["infrastructure", "host", "server", "logs"]
    result_format: "table"

  - id: host_distribution
    version: "1.0.0"
    description: "Show log distribution across hosts and identify potential hotspots"
    category: "infrastructure"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
              {% if environment %}
              ,{
                "term": {
                  "environment": "{{environment}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": 0,
        "aggs": {
          "by_host": {
            "terms": {
              "field": "host.keyword",
              "size": {{agg_size}},
              "order": {
                "_count": "desc"
              }
            },
            "aggs": {
              "by_level": {
                "terms": {
                  "field": "level.keyword",
                  "size": 5
                }
              },
              "avg_response_time": {
                "avg": {
                  "field": "response_time"
                }
              },
              "service": {
                "terms": {
                  "field": "service_name.keyword",
                  "size": 1
                }
              }
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-1h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: service_name
        type: string
        required: false
        description: "Filter by specific service"
        location: "body"

      - name: environment
        type: string
        required: false
        description: "Filter by environment"
        location: "body"
        allowed_values: ["production", "staging", "development"]

      - name: agg_size
        type: integer
        required: false
        default: 20
        description: "Number of hosts to return"
        location: "body"

    nl_examples:
      - "Show log distribution by host"
      - "Which hosts are most active?"
      - "Find hot spots in infrastructure"
      - "Show server load distribution"
      - "Compare activity across hosts"
      - "Which instances are busiest?"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "terms"
      group_by: "host"
      qualifiers: ["distribution", "infrastructure"]

    tags: ["infrastructure", "hosts", "distribution", "analytics"]
    result_format: "summary"

  # ============================================================================
  # DEBUG & LOGGER TEMPLATES
  # ============================================================================

  - id: search_by_logger
    version: "1.0.0"
    description: "Search logs from a specific logger/component"
    category: "debugging"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "wildcard": {
                  "logger.keyword": "*{{logger_pattern}}*"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if level %}
              ,{
                "term": {
                  "level": "{{level}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "level", "message", "logger", "service_name"]
      }

    parameters:
      - name: logger_pattern
        type: string
        required: true
        description: "Logger name pattern to search for"
        location: "body"
        example: "activityLogger"

      - name: level
        type: string
        required: false
        description: "Log level to filter"
        location: "body"
        allowed_values: ["ERROR", "WARN", "INFO", "DEBUG", "TRACE"]

      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Show logs from activityLogger"
      - "Find logs from the payment-service logger"
      - "Get debug logs from scientistLogger"
      - "Search logs by logger name"
      - "Show northLogger output"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["logger", "component", "module"]

    tags: ["debugging", "logger", "component", "logs"]
    result_format: "table"

  - id: search_debug_logs
    version: "1.0.0"
    description: "Search DEBUG level logs with optional query parameter filtering"
    category: "debugging"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "term": {
                  "level": "DEBUG"
                }
              }
              {% if message %}
              ,{
                "match": {
                  "message": "{{message}}"
                }
              }
              {% endif %}
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
              {% if endpoint %}
              ,{
                "wildcard": {
                  "endpoint.keyword": "*{{endpoint}}*"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "message", "logger", "service_name", "endpoint", "request_id"]
      }

    parameters:
      - name: message
        type: string
        required: false
        description: "Message text to search for"
        location: "body"
        example: "Query parameters"

      - name: service_name
        type: string
        required: false
        description: "Service name to filter"
        location: "body"

      - name: endpoint
        type: string
        required: false
        description: "Endpoint to filter"
        location: "body"

      - name: start_time
        type: string
        required: false
        default: "now-1h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 100
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Show me debug logs"
      - "Find debug output from inventory service"
      - "Show debug logs with query parameters"
      - "Get debug level entries"
      - "Search debug logs for the last hour"
      - "Find verbose logging output"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["debug", "verbose", "trace"]

    tags: ["debugging", "debug", "verbose", "logs"]
    result_format: "table"

  # ============================================================================
  # STATUS CODE ANALYSIS TEMPLATES
  # ============================================================================

  - id: status_code_distribution
    version: "1.0.0"
    description: "Analyze HTTP status code distribution across services"
    category: "http_analytics"
    complexity: "medium"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "must": [
              {
                "exists": {
                  "field": "status_code"
                }
              }
            ],
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
              {% if environment %}
              ,{
                "term": {
                  "environment": "{{environment}}"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": 0,
        "aggs": {
          "status_codes": {
            "terms": {
              "field": "status_code",
              "size": 20,
              "order": {
                "_count": "desc"
              }
            },
            "aggs": {
              "by_service": {
                "terms": {
                  "field": "service_name.keyword",
                  "size": 10
                }
              },
              "avg_response_time": {
                "avg": {
                  "field": "response_time"
                }
              }
            }
          },
          "status_ranges": {
            "range": {
              "field": "status_code",
              "ranges": [
                { "key": "2xx_success", "from": 200, "to": 300 },
                { "key": "3xx_redirect", "from": 300, "to": 400 },
                { "key": "4xx_client_error", "from": 400, "to": 500 },
                { "key": "5xx_server_error", "from": 500, "to": 600 }
              ]
            }
          }
        }
      }

    parameters:
      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: service_name
        type: string
        required: false
        description: "Filter by specific service"
        location: "body"

      - name: environment
        type: string
        required: false
        description: "Filter by environment"
        location: "body"
        allowed_values: ["production", "staging", "development"]

    nl_examples:
      - "Show status code distribution"
      - "How many 500 errors do we have?"
      - "What's the breakdown of HTTP status codes?"
      - "Show me 4xx vs 5xx errors"
      - "Analyze HTTP response codes"
      - "Status code summary"

    semantic_tags:
      action: "aggregate"
      primary_entity: "application_logs"
      aggregation_type: "terms"
      group_by: "status_code"
      qualifiers: ["http", "status", "distribution"]

    tags: ["http", "status_code", "analytics", "errors"]
    result_format: "summary"

  - id: find_4xx_errors
    version: "1.0.0"
    description: "Find client-side 4xx HTTP errors"
    category: "http_analytics"
    complexity: "simple"

    index: "application-logs-demo"
    http_method: "POST"
    endpoint: "/{index}/_search"
    endpoint_type: "_search"

    query_dsl: |
      {
        "query": {
          "bool": {
            "filter": [
              {
                "range": {
                  "timestamp": {
                    "gte": "{{start_time}}",
                    "lte": "{{end_time}}"
                  }
                }
              },
              {
                "range": {
                  "status_code": {
                    "gte": 400,
                    "lt": 500
                  }
                }
              }
              {% if service_name %}
              ,{
                "term": {
                  "service_name": "{{service_name}}"
                }
              }
              {% endif %}
              {% if endpoint %}
              ,{
                "wildcard": {
                  "endpoint.keyword": "*{{endpoint}}*"
                }
              }
              {% endif %}
            ]
          }
        },
        "size": {{limit}},
        "sort": [
          {
            "timestamp": {
              "order": "desc"
            }
          }
        ],
        "_source": ["timestamp", "level", "message", "service_name", "endpoint", "status_code", "user_id", "request_id"]
      }

    parameters:
      - name: service_name
        type: string
        required: false
        description: "Filter by specific service"
        location: "body"

      - name: endpoint
        type: string
        required: false
        description: "Filter by endpoint"
        location: "body"

      - name: start_time
        type: string
        required: false
        default: "now-24h"
        description: "Start of time range"
        location: "body"

      - name: end_time
        type: string
        required: false
        default: "now"
        description: "End of time range"
        location: "body"

      - name: limit
        type: integer
        required: false
        default: 50
        description: "Maximum number of results"
        location: "body"

    nl_examples:
      - "Show me 4xx errors"
      - "Find client errors"
      - "What 400 errors occurred?"
      - "Show 404 not found errors"
      - "Find bad request errors"
      - "List unauthorized requests"

    semantic_tags:
      action: "search"
      primary_entity: "application_logs"
      qualifiers: ["4xx", "client_error", "http"]

    tags: ["http", "4xx", "client_error", "errors"]
    result_format: "table"

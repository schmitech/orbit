import:
  - "adapters.yaml"
  - "inference.yaml"
  - "datasources.yaml"
  - "embeddings.yaml"
  - "rerankers.yaml"
  - "stores.yaml"
  - "moderators.yaml"
  - "guardrails.yaml"
  - "vision.yaml"

general:
  port: 3000
  verbose: false
  https:
    enabled: false
    port: 3443
    cert_file: "./cert.pem"
    key_file: "./key.pem"
  session_id:
    header_name: "X-Session-ID"
    required: true
  inference_provider: "ollama_cloud"
  inference_only: false

language_detection:
  enabled: true
  backends:
    - "langdetect"
    - "langid"
    - "pycld2"
  backend_weights:
    langdetect: 1.0
    langid: 1.2
    pycld2: 1.5
  min_confidence: 0.5
  min_margin: 0.1
  prefer_english_for_ascii: false
  enable_stickiness: false
  fallback_language: "en"

performance:
  workers: 4
  keep_alive_timeout: 30
  
  thread_pools:
    io_workers: 50              # Up from 10
    cpu_workers: 30             # CPU-bound tasks
    inference_workers: 20       # Model inference
    embedding_workers: 15       # Embedding generation
    db_workers: 25              # Database operations

fault_tolerance:
  circuit_breaker:
    failure_threshold: 5
    recovery_timeout: 30
    success_threshold: 3
    timeout: 30
    max_recovery_timeout: 300.0
    enable_exponential_backoff: true
  execution:
    strategy: "all"  # "all", "first_success", "best_effort"
    timeout: 35 
    max_retries: 3
    retry_delay: 1
  
messages:
  no_results_response: "I'm sorry, but I don't have any specific information about that topic in my knowledge base."
  collection_not_found: "I couldn't find the requested collection. Please make sure the collection exists before querying it."

auth:
  enabled: true
  session_duration_hours: 12
  default_admin_username: admin
  default_admin_password: ${ORBIT_DEFAULT_ADMIN_PASSWORD}
  pbkdf2_iterations: 600000
  # Credential storage method: "keyring" (default) or "file"
  # - keyring: Uses system keychain (macOS Keychain, Linux Secret Service)
  # - file: Uses plain text file in ~/.orbit/.env (less secure but visible)
  credential_storage: file

# Embedding configuration moved to embeddings.yaml

api_keys:
  header_name: "X-API-Key"
  prefix: "orbit_"

prompt_service:
  cache:
    ttl_seconds: 3600  # 1 hour - how long to cache prompts in Redis

logging:
  level: "INFO"
  handlers:
    file:
      enabled: true
      directory: "logs"
      filename: "orbit.log"
      max_size_mb: 10
      backup_count: 30
      rotation: "midnight"
      format: "text"
    console:
      enabled: false
      format: "text"
  capture_warnings: true
  propagate: false
  loggers:
    # Suppress all Python warnings (ResourceWarnings, DeprecationWarnings, etc.)
    py.warnings:
      level: "ERROR"
      propagate: false
      disabled: true
    inference.clients.llama_cpp:
      level: "ERROR"
    llama_cpp:
      level: "ERROR"
    llama_cpp.llama:
      level: "ERROR"
    ggml:
      level: "ERROR"
    metal:
      level: "ERROR"
    httpx:
      level: "WARNING"
    httpcore:
      level: "WARNING"
    # Suppress docling library verbose output (document processing)
    docling:
      level: "WARNING"
    docling.datamodel.document:
      level: "WARNING"
    docling.document_converter:
      level: "WARNING"
    docling.pipeline.base_pipeline:
      level: "WARNING"
    docling.backend.msexcel_backend:
      level: "WARNING"
    docling.backend.pypdfium2_backend:
      level: "WARNING"
    docling.backend.docling_parse_backend:
      level: "WARNING"

clock_service:
  enabled: true
  default_timezone: "America/Toronto"
  format: "%A, %B %d, %Y at %I:%M:%S %p %Z"

internal_services:
  # Backend database configuration
  # Choose between 'sqlite' (no installation required) or 'mongodb' (requires MongoDB server)
  backend:
    type: "sqlite" # sqlite or mongodb
    sqlite:
      database_path: "orbit.db"  # Path to SQLite database file (relative to project root)
  
  elasticsearch:
    enabled: false
    node: ${INTERNAL_SERVICES_ELASTICSEARCH_NODE}
    index: 'orbit'
    username: ${INTERNAL_SERVICES_ELASTICSEARCH_USERNAME}
    password: ${INTERNAL_SERVICES_ELASTICSEARCH_PASSWORD}

  mongodb:
    host: ${INTERNAL_SERVICES_MONGODB_HOST}
    port: ${INTERNAL_SERVICES_MONGODB_PORT}
    username: ${INTERNAL_SERVICES_MONGODB_USERNAME}
    password: ${INTERNAL_SERVICES_MONGODB_PASSWORD}
    database: ${INTERNAL_SERVICES_MONGODB_DB}
    users_collection: users
    sessions_collection: sessions
    apikey_collection: api_keys
    prompts_collection: system_prompts

  redis:
    enabled: false
    host: ${INTERNAL_SERVICES_REDIS_HOST}
    port: ${INTERNAL_SERVICES_REDIS_PORT}
    db: 0
    username: ${INTERNAL_SERVICES_REDIS_USERNAME}
    password: ${INTERNAL_SERVICES_REDIS_PASSWORD}
    use_ssl: false
    ttl: 3600  # 1 hour, matching temp_key_expiry

chat_history:
  enabled: true
  collection_name: "chat_history"
  store_metadata: true
  retention_days: 90
  max_tracked_sessions: 10000
  session:
    auto_generate: false
    required: true
    header_name: "X-Session-ID"
  user:
    header_name: "X-User-ID"
    required: false

files:
  # Global defaults for all file adapters
  # Individual adapters in adapters.yaml can override these settings
  
  metadata_db_path: "files.db"  # Path to SQLite database for file metadata (relative to project root)
  
  # Default storage configuration (can be overridden per adapter)
  storage_root: "./uploads"  # Default root directory for storing uploaded files
  
  # Default processing settings (can be overridden per adapter)
  default_chunking_strategy: "fixed"  # Default: "fixed" or "semantic"
  default_chunk_size: 1000  # Default chunk size for fixed chunking (characters)
  default_chunk_overlap: 200  # Default overlap for fixed chunking (characters)
  
  # Default vector store settings (can be overridden per adapter)
  default_vector_store: "chroma"  # Default vector store to use
  default_collection_prefix: "files_"  # Default prefix for collection names

reranker:
  provider: "ollama"
  enabled: false

monitoring:
  enabled: true                    # Enable/disable monitoring dashboard
  metrics:
    collection_interval: 5         # Seconds between metric collections
    time_window: 300              # Seconds of historical data to keep (5 minutes)
    prometheus:
      enabled: true               # Enable Prometheus endpoint at /metrics
    dashboard:
      enabled: true               # Enable web dashboard at /dashboard
      websocket_update_interval: 5 # Seconds between WebSocket updates
  alerts:                         # Alert thresholds (future use)
    cpu_threshold: 90             # Alert when CPU > 90%
    memory_threshold: 85          # Alert when memory > 85%
    error_rate_threshold: 5       # Alert when error rate > 5%
    response_time_threshold: 5000 # Alert when avg response time > 5000ms
